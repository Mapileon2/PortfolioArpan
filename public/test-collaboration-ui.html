<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaboration UI Components Test</title>
    
    <!-- Collaboration UI styles -->
    <link rel="stylesheet" href="css/collaboration-ui.css">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .test-header {
            background: #007bff;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .test-header h1 {
            margin: 0;
            font-size: 28px;
        }
        
        .test-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .test-controls {
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            background: #f8f9fa;
        }
        
        .test-controls h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .control-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .control-group:last-child {
            margin-bottom: 0;
        }
        
        .test-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            color: #333;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .test-btn:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }
        
        .test-btn.primary {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .test-btn.primary:hover {
            background: #0056b3;
            border-color: #0056b3;
        }
        
        .test-btn.success {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }
        
        .test-btn.warning {
            background: #ffc107;
            color: #212529;
            border-color: #ffc107;
        }
        
        .test-btn.danger {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }
        
        .test-editor {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            box-sizing: border-box;
        }
        
        .test-editor:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        .status-panel {
            padding: 15px 20px;
            background: #e9ecef;
            border-top: 1px solid #dee2e6;
            font-size: 14px;
        }
        
        .status-item {
            display: inline-block;
            margin-right: 20px;
            padding: 4px 8px;
            border-radius: 4px;
            background: white;
            border: 1px solid #dee2e6;
        }
        
        .status-item.active {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .demo-cursors {
            position: relative;
            height: 100px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .demo-cursor {
            position: absolute;
            width: 2px;
            height: 20px;
            background: #007bff;
            animation: blink 1s infinite;
        }
        
        .demo-cursor.user2 { background: #28a745; }
        .demo-cursor.user3 { background: #ffc107; }
        .demo-cursor.user4 { background: #dc3545; }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .feature-demo {
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .feature-demo:last-child {
            border-bottom: none;
        }
        
        .feature-demo h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 18px;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .control-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="test-container" id="collaboration-container">
        <!-- Test Header -->
        <div class="test-header">
            <h1><i class="fas fa-users"></i> Collaboration UI Components Test</h1>
            <p>Interactive testing environment for real-time collaboration features</p>
        </div>
        
        <!-- Test Controls -->
        <div class="test-controls">
            <h3>Test Controls</h3>
            
            <div class="control-group">
                <button class="test-btn primary" onclick="initializeCollaboration()">
                    <i class="fas fa-play"></i> Initialize Collaboration
                </button>
                <button class="test-btn" onclick="showToolbar()">
                    <i class="fas fa-tools"></i> Show Toolbar
                </button>
                <button class="test-btn" onclick="showSidebar()">
                    <i class="fas fa-sidebar"></i> Show Sidebar
                </button>
                <button class="test-btn" onclick="showStatusBar()">
                    <i class="fas fa-info-circle"></i> Show Status Bar
                </button>
            </div>
            
            <div class="control-group">
                <button class="test-btn success" onclick="simulateSession()">
                    <i class="fas fa-users"></i> Simulate Session
                </button>
                <button class="test-btn" onclick="simulateParticipants()">
                    <i class="fas fa-user-plus"></i> Add Participants
                </button>
                <button class="test-btn" onclick="simulateComments()">
                    <i class="fas fa-comments"></i> Add Comments
                </button>
                <button class="test-btn warning" onclick="simulateConflict()">
                    <i class="fas fa-exclamation-triangle"></i> Simulate Conflict
                </button>
            </div>
            
            <div class="control-group">
                <button class="test-btn" onclick="testNotifications()">
                    <i class="fas fa-bell"></i> Test Notifications
                </button>
                <button class="test-btn" onclick="testCursors()">
                    <i class="fas fa-mouse-pointer"></i> Test Cursors
                </button>
                <button class="test-btn" onclick="testThemes()">
                    <i class="fas fa-palette"></i> Toggle Theme
                </button>
                <button class="test-btn danger" onclick="resetTest()">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>
        </div>
        
        <!-- Main Editor Area -->
        <div class="feature-demo">
            <h4>Collaborative Editor</h4>
            <textarea 
                id="case-study-editor" 
                class="test-editor" 
                placeholder="Start typing to test real-time collaboration features...

This is a test editor for collaboration features:

1. Type to see cursor tracking
2. Select text to test selection sync
3. Use the controls above to test various features
4. Open multiple browser tabs to test multi-user collaboration

# Sample Content

## Introduction
This is sample content for testing the collaborative editor.

## Features to Test
- Real-time text synchronization
- Live cursor tracking
- Comment system
- Conflict resolution
- User presence indicators

## Instructions
1. Initialize collaboration using the button above
2. Open this page in multiple browser tabs
3. Start typing in different tabs to see real-time sync
4. Test commenting and other collaborative features
">
            </textarea>
            
            <!-- Demo cursor area -->
            <div class="demo-cursors" id="demo-cursors">
                <div style="padding: 10px; color: #6c757d; font-size: 12px;">
                    Live cursors from other users will appear here
                </div>
            </div>
        </div>
        
        <!-- Feature Demonstrations -->
        <div class="feature-demo">
            <h4>UI Component Tests</h4>
            
            <div class="demo-grid">
                <div>
                    <h5>Toolbar Components</h5>
                    <div class="control-group">
                        <button class="test-btn" onclick="testStartSession()">Start Session</button>
                        <button class="test-btn" onclick="testJoinSession()">Join Session</button>
                        <button class="test-btn" onclick="testLeaveSession()">Leave Session</button>
                    </div>
                </div>
                
                <div>
                    <h5>Comment System</h5>
                    <div class="control-group">
                        <button class="test-btn" onclick="testAddComment()">Add Comment</button>
                        <button class="test-btn" onclick="testReplyComment()">Add Reply</button>
                        <button class="test-btn" onclick="testResolveComment()">Resolve Comment</button>
                    </div>
                </div>
                
                <div>
                    <h5>Presence Features</h5>
                    <div class="control-group">
                        <button class="test-btn" onclick="testUserJoin()">User Join</button>
                        <button class="test-btn" onclick="testUserLeave()">User Leave</button>
                        <button class="test-btn" onclick="testPresenceUpdate()">Update Presence</button>
                    </div>
                </div>
                
                <div>
                    <h5>Conflict Resolution</h5>
                    <div class="control-group">
                        <button class="test-btn" onclick="testConflictDetection()">Detect Conflict</button>
                        <button class="test-btn" onclick="testConflictResolution()">Resolve Conflict</button>
                        <button class="test-btn" onclick="testMergeContent()">Test Merge</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Panel -->
        <div class="status-panel">
            <strong>Status:</strong>
            <span class="status-item" id="status-collaboration">Collaboration: Not initialized</span>
            <span class="status-item" id="status-session">Session: None</span>
            <span class="status-item" id="status-participants">Participants: 0</span>
            <span class="status-item" id="status-comments">Comments: 0</span>
        </div>
    </div>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Collaboration Service -->
    <script src="js/collaboration-service.js"></script>
    
    <!-- Collaboration UI -->
    <script src="js/collaboration-ui.js"></script>
    
    <script>
        // Test configuration
        const SUPABASE_URL = 'https://fzyrsurzgepeawvfjved.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ6eXJzdXJ6Z2VwZWF3dmZqdmVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NjIyMDYsImV4cCI6MjA3NTIzODIwNn0.cKBp1Sw8l2mY3AxqXiazxe9BFaB3LaZmvzVZvod_42Y';
        
        // Global variables
        let collaborationUI = null;
        let testSession = null;
        let testParticipants = [];
        let testComments = [];
        let currentTheme = 'light';
        
        // Mock data for testing
        const mockUsers = [
            { id: 'user1', name: 'Alice Johnson', email: 'alice@example.com' },
            { id: 'user2', name: 'Bob Smith', email: 'bob@example.com' },
            { id: 'user3', name: 'Carol Davis', email: 'carol@example.com' },
            { id: 'user4', name: 'David Wilson', email: 'david@example.com' }
        ];
        
        const mockComments = [
            { id: 'comment1', text: 'This section needs more detail', type: 'suggestion', author: 'Alice Johnson' },
            { id: 'comment2', text: 'Great explanation here!', type: 'comment', author: 'Bob Smith' },
            { id: 'comment3', text: 'Should we add an example?', type: 'question', author: 'Carol Davis' },
            { id: 'comment4', text: 'Approved for publication', type: 'approval', author: 'David Wilson' }
        ];
        
        // Initialize Supabase (mock for testing)
        if (SUPABASE_URL !== 'YOUR_SUPABASE_URL') {
            window.supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        } else {
            // Mock Supabase for testing without real backend
            window.supabase = {
                auth: {
                    getUser: () => Promise.resolve({ 
                        data: { user: { id: 'test-user', email: 'test@example.com' } } 
                    })
                }
            };
        }
        
        // Test Functions
        
        function initializeCollaboration() {
            try {
                collaborationUI = new CollaborationUI({
                    containerSelector: '#collaboration-container',
                    editorSelector: '#case-study-editor',
                    enableComments: true,
                    enablePresence: true,
                    enableConflictResolution: true,
                    theme: currentTheme
                });
                
                updateStatus('collaboration', 'Initialized', true);
                showNotification('Collaboration UI initialized successfully', 'success');
                
                // Setup test event listeners
                setupTestEventListeners();
                
            } catch (error) {
                console.error('Failed to initialize collaboration:', error);
                showNotification('Failed to initialize collaboration UI', 'error');
            }
        }
        
        function setupTestEventListeners() {
            if (!collaborationUI || !collaborationUI.collaborationService) return;
            
            // Mock event listeners for testing
            collaborationUI.collaborationService.on = (event, handler) => {
                console.log(`Event listener added for: ${event}`);
            };
        }
        
        function showToolbar() {
            if (!collaborationUI) {
                showNotification('Please initialize collaboration first', 'warning');
                return;
            }
            
            const toolbar = document.querySelector('.collaboration-toolbar');
            if (toolbar) {
                toolbar.style.display = 'flex';
                showNotification('Toolbar displayed', 'info');
            } else {
                showNotification('Toolbar not found - may need to be created', 'warning');
            }
        }
        
        function showSidebar() {
            if (!collaborationUI) {
                showNotification('Please initialize collaboration first', 'warning');
                return;
            }
            
            if (collaborationUI.sidebar) {
                collaborationUI.showSidebar();
                showNotification('Sidebar opened', 'info');
            } else {
                showNotification('Sidebar not available', 'warning');
            }
        }
        
        function showStatusBar() {
            if (!collaborationUI) {
                showNotification('Please initialize collaboration first', 'warning');
                return;
            }
            
            const statusBar = document.querySelector('.collaboration-status-bar');
            if (statusBar) {
                statusBar.style.display = 'flex';
                showNotification('Status bar displayed', 'info');
            } else {
                showNotification('Status bar not found', 'warning');
            }
        }
        
        function simulateSession() {
            testSession = {
                id: 'test-session-123',
                session_id: 'test-session-123',
                session_name: 'Test Collaboration Session',
                owner_id: 'test-user',
                participants: ['test-user'],
                status: 'active',
                created_at: new Date().toISOString()
            };
            
            if (collaborationUI) {
                collaborationUI.handleSessionJoined(testSession);
            }
            
            updateStatus('session', testSession.session_name, true);
            showNotification('Test session created and joined', 'success');
        }
        
        function simulateParticipants() {
            testParticipants = mockUsers.slice(0, 3);
            
            if (collaborationUI) {
                collaborationUI.displayParticipants(testParticipants);
                collaborationUI.updateParticipantCount(testParticipants.length);
            }
            
            updateStatus('participants', testParticipants.length, true);
            showNotification(`${testParticipants.length} participants added`, 'success');
        }
        
        function simulateComments() {
            testComments = mockComments.slice(0, 2);
            
            if (collaborationUI) {
                collaborationUI.displayComments(testComments);
            }
            
            updateStatus('comments', testComments.length, true);
            showNotification(`${testComments.length} comments added`, 'success');
        }
        
        function simulateConflict() {
            const conflict = {
                id: 'conflict-123',
                conflict_type: 'edit_overlap',
                conflicting_content_1: 'This is the local version of the text.',
                conflicting_content_2: 'This is the remote version of the text.',
                content_position: 100
            };
            
            if (collaborationUI) {
                collaborationUI.showConflictPanel(conflict);
            }
            
            showNotification('Conflict simulation displayed', 'warning');
        }
        
        function testNotifications() {
            const types = ['success', 'error', 'info', 'warning'];
            const messages = [
                'This is a success notification',
                'This is an error notification', 
                'This is an info notification',
                'This is a warning notification'
            ];
            
            types.forEach((type, index) => {
                setTimeout(() => {
                    showNotification(messages[index], type);
                }, index * 1000);
            });
        }
        
        function testCursors() {
            const cursorsContainer = document.getElementById('demo-cursors');
            cursorsContainer.innerHTML = '';
            
            mockUsers.forEach((user, index) => {
                const cursor = document.createElement('div');
                cursor.className = `demo-cursor user${index + 1}`;
                cursor.style.left = `${20 + index * 60}px`;
                cursor.style.top = '40px';
                cursor.title = user.name;
                
                cursorsContainer.appendChild(cursor);
            });
            
            showNotification('Live cursors simulated', 'info');
        }
        
        function testThemes() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            const container = document.getElementById('collaboration-container');
            container.classList.remove('collab-theme-light', 'collab-theme-dark');
            container.classList.add(`collab-theme-${currentTheme}`);
            
            showNotification(`Switched to ${currentTheme} theme`, 'info');
        }
        
        function resetTest() {
            // Reset all test data
            testSession = null;
            testParticipants = [];
            testComments = [];
            
            // Reset UI
            updateStatus('collaboration', 'Not initialized', false);
            updateStatus('session', 'None', false);
            updateStatus('participants', '0', false);
            updateStatus('comments', '0', false);
            
            // Clear demo cursors
            document.getElementById('demo-cursors').innerHTML = 
                '<div style="padding: 10px; color: #6c757d; font-size: 12px;">Live cursors from other users will appear here</div>';
            
            // Reset editor
            document.getElementById('case-study-editor').value = document.getElementById('case-study-editor').placeholder;
            
            // Destroy collaboration UI if exists
            if (collaborationUI) {
                collaborationUI.destroy();
                collaborationUI = null;
            }
            
            showNotification('Test environment reset', 'info');
        }
        
        // Individual feature tests
        function testStartSession() {
            if (collaborationUI) {
                collaborationUI.showStartSessionDialog();
            } else {
                showNotification('Please initialize collaboration first', 'warning');
            }
        }
        
        function testJoinSession() {
            if (collaborationUI) {
                collaborationUI.showJoinSessionDialog();
            } else {
                showNotification('Please initialize collaboration first', 'warning');
            }
        }
        
        function testLeaveSession() {
            if (collaborationUI && testSession) {
                collaborationUI.handleSessionLeft(testSession);
                updateStatus('session', 'None', false);
                showNotification('Left test session', 'info');
            } else {
                showNotification('No active session to leave', 'warning');
            }
        }
        
        function testAddComment() {
            if (collaborationUI) {
                collaborationUI.showCommentModal();
            } else {
                showNotification('Please initialize collaboration first', 'warning');
            }
        }
        
        function testReplyComment() {
            if (testComments.length > 0) {
                const comment = testComments[0];
                const reply = prompt('Enter reply text:');
                if (reply) {
                    showNotification(`Reply added to comment by ${comment.author}`, 'success');
                }
            } else {
                showNotification('No comments to reply to', 'warning');
            }
        }
        
        function testResolveComment() {
            if (testComments.length > 0) {
                showNotification('Comment resolved', 'success');
            } else {
                showNotification('No comments to resolve', 'warning');
            }
        }
        
        function testUserJoin() {
            const user = mockUsers[Math.floor(Math.random() * mockUsers.length)];
            showNotification(`${user.name} joined the session`, 'info');
        }
        
        function testUserLeave() {
            const user = mockUsers[Math.floor(Math.random() * mockUsers.length)];
            showNotification(`${user.name} left the session`, 'info');
        }
        
        function testPresenceUpdate() {
            const statuses = ['active', 'idle', 'away'];
            const status = statuses[Math.floor(Math.random() * statuses.length)];
            showNotification(`Presence updated to: ${status}`, 'info');
        }
        
        function testConflictDetection() {
            showNotification('Editing conflict detected between users', 'warning');
        }
        
        function testConflictResolution() {
            showNotification('Conflict resolved using merge strategy', 'success');
        }
        
        function testMergeContent() {
            showNotification('Content merged successfully', 'success');
        }
        
        // Utility functions
        function updateStatus(type, value, active = false) {
            const element = document.getElementById(`status-${type}`);
            if (element) {
                element.textContent = `${type.charAt(0).toUpperCase() + type.slice(1)}: ${value}`;
                element.classList.toggle('active', active);
            }
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `collab-notification collab-notification-${type}`;
            notification.textContent = message;
            notification.style.display = 'block';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Auto-initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Collaboration UI test page loaded');
            showNotification('Test environment ready. Click "Initialize Collaboration" to begin.', 'info');
        });
    </script>
</body>
</html>