<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Resizer Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div class="max-w-6xl mx-auto p-6">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">üñºÔ∏è Image Resizer & Upload Demo</h1>
            
            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <button onclick="openResizeDialog()" class="bg-blue-600 text-white px-6 py-4 rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-magic mr-2"></i>
                    <div>
                        <div class="font-semibold">Smart Resize</div>
                        <div class="text-sm opacity-90">Upload & resize with presets</div>
                    </div>
                </button>
                
                <button onclick="uploadMultipleSizes()" class="bg-green-600 text-white px-6 py-4 rounded-lg hover:bg-green-700 transition">
                    <i class="fas fa-layer-group mr-2"></i>
                    <div>
                        <div class="font-semibold">Multiple Sizes</div>
                        <div class="text-sm opacity-90">Create thumbnail, medium, large</div>
                    </div>
                </button>
                
                <button onclick="testTransformations()" class="bg-purple-600 text-white px-6 py-4 rounded-lg hover:bg-purple-700 transition">
                    <i class="fas fa-flask mr-2"></i>
                    <div>
                        <div class="font-semibold">Test Transformations</div>
                        <div class="text-sm opacity-90">Test various resize options</div>
                    </div>
                </button>
            </div>

            <!-- Preset Gallery -->
            <div class="mb-8">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Available Presets</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
                    <div class="preset-demo bg-gray-100 rounded-lg p-4 text-center">
                        <div class="w-full h-20 bg-blue-200 rounded mb-2 flex items-center justify-center">
                            <span class="text-xs">300√ó200</span>
                        </div>
                        <div class="text-sm font-medium">Thumbnail</div>
                    </div>
                    
                    <div class="preset-demo bg-gray-100 rounded-lg p-4 text-center">
                        <div class="w-full h-20 bg-green-200 rounded mb-2 flex items-center justify-center">
                            <span class="text-xs">600√ó400</span>
                        </div>
                        <div class="text-sm font-medium">Small</div>
                    </div>
                    
                    <div class="preset-demo bg-gray-100 rounded-lg p-4 text-center">
                        <div class="w-full h-20 bg-yellow-200 rounded mb-2 flex items-center justify-center">
                            <span class="text-xs">1200√ó800</span>
                        </div>
                        <div class="text-sm font-medium">Medium</div>
                    </div>
                    
                    <div class="preset-demo bg-gray-100 rounded-lg p-4 text-center">
                        <div class="w-full h-20 bg-red-200 rounded mb-2 flex items-center justify-center">
                            <span class="text-xs">1920√ó1080</span>
                        </div>
                        <div class="text-sm font-medium">Large</div>
                    </div>
                    
                    <div class="preset-demo bg-gray-100 rounded-lg p-4 text-center">
                        <div class="w-full h-20 bg-purple-200 rounded mb-2 flex items-center justify-center">
                            <span class="text-xs">500√ó500</span>
                        </div>
                        <div class="text-sm font-medium">Square</div>
                    </div>
                    
                    <div class="preset-demo bg-gray-100 rounded-lg p-4 text-center">
                        <div class="w-full h-20 bg-indigo-200 rounded mb-2 flex items-center justify-center">
                            <span class="text-xs">1200√ó400</span>
                        </div>
                        <div class="text-sm font-medium">Banner</div>
                    </div>
                    
                    <div class="preset-demo bg-gray-100 rounded-lg p-4 text-center">
                        <div class="w-full h-20 bg-pink-200 rounded mb-2 flex items-center justify-center">
                            <span class="text-xs">1920√ó600</span>
                        </div>
                        <div class="text-sm font-medium">Hero</div>
                    </div>
                </div>
            </div>

            <!-- Results Display -->
            <div id="resultsSection" class="hidden">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Upload Results</h2>
                <div id="resultsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Results will be displayed here -->
                </div>
            </div>

            <!-- Status Messages -->
            <div id="statusMessages" class="mt-6">
                <!-- Status messages will appear here -->
            </div>
        </div>
    </div>

    <!-- Load Services -->
    <script src="js/cloudinary-sdk-service.js"></script>
    <script src="js/image-resizer-service.js"></script>
    
    <script>
        // Global functions for demo
        function openResizeDialog() {
            if (window.imageResizerService) {
                window.imageResizerService.showResizeDialog((result) => {
                    console.log('Resize result:', result);
                    displayResults(Array.isArray(result) ? result : [result]);
                });
            } else {
                alert('Image Resizer Service not loaded');
            }
        }

        function uploadMultipleSizes() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    try {
                        showStatus('info', 'Creating multiple sizes...');
                        
                        const results = await window.imageResizerService.createMultipleSizes(
                            file, 
                            ['thumbnail', 'medium', 'large'],
                            { quality: 'auto:good', crop: 'fill' }
                        );
                        
                        displayResults(results);
                        showStatus('success', `Created ${results.filter(r => r.success).length} sizes successfully!`);
                        
                    } catch (error) {
                        showStatus('error', `Failed to create multiple sizes: ${error.message}`);
                    }
                }
            };
            input.click();
        }

        function testTransformations() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    try {
                        showStatus('info', 'Testing various transformations...');
                        
                        const transformations = [
                            { name: 'Original Quality', options: { width: 800, height: 600, quality: '100' } },
                            { name: 'Compressed', options: { width: 800, height: 600, quality: '60' } },
                            { name: 'Square Crop', options: { width: 400, height: 400, crop: 'fill' } },
                            { name: 'Fit Mode', options: { width: 800, height: 600, crop: 'fit' } }
                        ];
                        
                        const results = [];
                        
                        for (const transform of transformations) {
                            try {
                                const result = await window.imageResizerService.uploadWithResize(file, {
                                    ...transform.options,
                                    folder: 'portfolio/test-transforms'
                                });
                                
                                results.push({
                                    ...result,
                                    transformName: transform.name
                                });
                            } catch (error) {
                                results.push({
                                    success: false,
                                    transformName: transform.name,
                                    error: error.message
                                });
                            }
                        }
                        
                        displayResults(results);
                        showStatus('success', `Completed ${results.filter(r => r.success).length} transformations!`);
                        
                    } catch (error) {
                        showStatus('error', `Transformation test failed: ${error.message}`);
                    }
                }
            };
            input.click();
        }

        function displayResults(results) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsGrid = document.getElementById('resultsGrid');
            
            resultsSection.classList.remove('hidden');
            
            const resultCards = results.map(result => {
                if (!result.success) {
                    return `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
                                <h3 class="font-semibold text-red-900">${result.transformName || result.size || 'Upload'} Failed</h3>
                            </div>
                            <p class="text-sm text-red-700">${result.error}</p>
                        </div>
                    `;
                }
                
                return `
                    <div class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition">
                        <img src="${result.url}" alt="${result.transformName || result.size || 'Resized image'}" 
                             class="w-full h-32 object-cover">
                        <div class="p-4">
                            <h3 class="font-semibold text-gray-900 mb-2">${result.transformName || result.size || 'Resized Image'}</h3>
                            <div class="text-sm text-gray-600 space-y-1">
                                <div><strong>Size:</strong> ${result.width} √ó ${result.height}</div>
                                <div><strong>File Size:</strong> ${(result.size / 1024 / 1024).toFixed(2)} MB</div>
                                <div><strong>Format:</strong> ${result.format?.toUpperCase()}</div>
                                ${result.transformation ? `<div><strong>Transform:</strong> ${result.transformation}</div>` : ''}
                            </div>
                            <div class="mt-3 flex space-x-2">
                                <button onclick="copyUrl('${result.url}')" 
                                        class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition">
                                    <i class="fas fa-copy mr-1"></i>Copy URL
                                </button>
                                <button onclick="openInNewTab('${result.url}')" 
                                        class="text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded hover:bg-gray-200 transition">
                                    <i class="fas fa-external-link-alt mr-1"></i>Open
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            resultsGrid.innerHTML = resultCards;
        }

        function showStatus(type, message) {
            const container = document.getElementById('statusMessages');
            const statusDiv = document.createElement('div');
            statusDiv.className = `p-4 rounded-lg mb-4 ${
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
                type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
                type === 'warning' ? 'bg-yellow-100 text-yellow-800 border border-yellow-200' :
                'bg-blue-100 text-blue-800 border border-blue-200'
            }`;
            
            statusDiv.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${
                        type === 'success' ? 'check-circle' :
                        type === 'error' ? 'exclamation-circle' :
                        type === 'warning' ? 'exclamation-triangle' :
                        'info-circle'
                    } mr-2"></i>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-auto text-current hover:opacity-75">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(statusDiv);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (statusDiv.parentElement) {
                    statusDiv.remove();
                }
            }, 5000);
        }

        function copyUrl(url) {
            navigator.clipboard.writeText(url).then(() => {
                showStatus('success', 'URL copied to clipboard!');
            }).catch(() => {
                showStatus('error', 'Failed to copy URL');
            });
        }

        function openInNewTab(url) {
            window.open(url, '_blank');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üñºÔ∏è Image Resizer Demo loaded');
            
            // Check if services are available
            setTimeout(() => {
                if (!window.imageResizerService) {
                    showStatus('warning', 'Image Resizer Service not loaded - some features may not work');
                } else {
                    showStatus('success', 'Image Resizer Service ready! Try uploading an image.');
                }
            }, 1000);
        });
    </script>
</body>
</html>