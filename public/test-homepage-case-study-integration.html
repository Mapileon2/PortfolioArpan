<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Homepage - Case Study Integration</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-6xl">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-600">Homepage "Magical Projects" ‚Üî Admin Dashboard Integration Test</h1>
        
        <!-- Integration Status -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4 text-green-600">
                <i class="fas fa-check-circle mr-2"></i>Integration Analysis Complete
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-semibold text-gray-900 mb-3">‚úÖ Connection Verified:</h3>
                    <ul class="text-sm text-gray-700 space-y-2">
                        <li>‚Ä¢ Homepage fetches from <code class="bg-gray-100 px-1 rounded">/api/case-studies</code></li>
                        <li>‚Ä¢ Admin dashboard manages same <code class="bg-gray-100 px-1 rounded">/api/case-studies</code></li>
                        <li>‚Ä¢ <code class="bg-gray-100 px-1 rounded">loadMagicalProjects()</code> function loads case studies</li>
                        <li>‚Ä¢ Projects displayed in <code class="bg-gray-100 px-1 rounded">#projectsGrid</code></li>
                        <li>‚Ä¢ Links to <code class="bg-gray-100 px-1 rounded">case_study.html?caseId=ID</code></li>
                        <li>‚Ä¢ Real-time updates when admin creates/edits/deletes</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900 mb-3">üîß Data Flow:</h3>
                    <div class="text-sm text-gray-700 space-y-2">
                        <div class="bg-blue-50 p-3 rounded">
                            <strong>1. Admin Dashboard</strong><br>
                            Create/Edit/Delete case studies
                        </div>
                        <div class="text-center">‚Üì</div>
                        <div class="bg-green-50 p-3 rounded">
                            <strong>2. Database</strong><br>
                            Supabase case_studies table
                        </div>
                        <div class="text-center">‚Üì</div>
                        <div class="bg-purple-50 p-3 rounded">
                            <strong>3. Homepage</strong><br>
                            "Magical Projects" section
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Test Actions -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <!-- Create Test Case Study -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-blue-600">
                    <i class="fas fa-plus mr-2"></i>Create Test Case Study
                </h2>
                <p class="text-gray-600 text-sm mb-4">Create a case study and see it appear on homepage</p>
                <button onclick="createTestCaseStudy()" 
                        class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-semibold">
                    Create & Test
                </button>
                <div id="createResult" class="mt-4 text-sm"></div>
            </div>
            
            <!-- Check Homepage -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-green-600">
                    <i class="fas fa-home mr-2"></i>Check Homepage
                </h2>
                <p class="text-gray-600 text-sm mb-4">View the homepage "Magical Projects" section</p>
                <a href="/index.html#projects" target="_blank" 
                   class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-semibold block text-center">
                    Open Homepage
                </a>
                <button onclick="checkHomepageProjects()" 
                        class="w-full bg-green-400 hover:bg-green-500 text-white py-2 rounded-lg font-semibold mt-2">
                    Check API Data
                </button>
                <div id="homepageResult" class="mt-4 text-sm"></div>
            </div>
            
            <!-- Admin Dashboard -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4 text-purple-600">
                    <i class="fas fa-cog mr-2"></i>Admin Dashboard
                </h2>
                <p class="text-gray-600 text-sm mb-4">Manage case studies from admin panel</p>
                <a href="/admin-dashboard.html#case-studies" target="_blank" 
                   class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-lg font-semibold block text-center">
                    Open Admin
                </a>
                <button onclick="checkAdminData()" 
                        class="w-full bg-purple-400 hover:bg-purple-500 text-white py-2 rounded-lg font-semibold mt-2">
                    Check Admin Data
                </button>
                <div id="adminResult" class="mt-4 text-sm"></div>
            </div>
        </div>
        
        <!-- Integration Test Results -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4 text-indigo-600">
                <i class="fas fa-sync mr-2"></i>Real-time Integration Test
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-semibold text-gray-900 mb-3">Test Steps:</h3>
                    <ol class="list-decimal list-inside text-sm text-gray-700 space-y-2">
                        <li>Click "Create & Test" to create a new case study</li>
                        <li>Note the case study ID and title</li>
                        <li>Click "Open Homepage" to view the homepage</li>
                        <li>Scroll to "Magical Projects" section</li>
                        <li>Verify your new case study appears</li>
                        <li>Click "Read Story" to test individual case study page</li>
                        <li>Go to Admin Dashboard to edit/delete</li>
                        <li>Refresh homepage to see changes</li>
                    </ol>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900 mb-3">Expected Results:</h3>
                    <ul class="list-disc list-inside text-sm text-gray-700 space-y-2">
                        <li>Case studies created in admin appear on homepage</li>
                        <li>Homepage shows title, description, category</li>
                        <li>Project cards have proper styling and images</li>
                        <li>Rating stars display correctly</li>
                        <li>"Read Story" links work</li>
                        <li>Changes in admin reflect on homepage</li>
                        <li>Deleted case studies disappear from homepage</li>
                        <li>No JavaScript errors in console</li>
                    </ul>
                </div>
            </div>
            <div class="mt-6 p-4 bg-yellow-50 rounded-lg">
                <h4 class="font-semibold text-yellow-800 mb-2">üîç Key Integration Points:</h4>
                <div class="text-sm text-yellow-700 space-y-1">
                    <div><strong>API Endpoint:</strong> <code>/api/case-studies</code> (shared by both)</div>
                    <div><strong>Homepage Function:</strong> <code>loadMagicalProjects()</code> in script.js</div>
                    <div><strong>Admin Function:</strong> <code>loadCaseStudiesData()</code> in admin-dashboard.html</div>
                    <div><strong>Display Container:</strong> <code>#projectsGrid</code> on homepage</div>
                    <div><strong>Individual Pages:</strong> <code>case_study.html?caseId=ID</code></div>
                </div>
            </div>
        </div>
        
        <!-- Current Case Studies -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4 text-gray-600">
                <i class="fas fa-list mr-2"></i>Current Case Studies
            </h2>
            <button onclick="loadCurrentCaseStudies()" 
                    class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-semibold mb-4">
                <i class="fas fa-refresh mr-2"></i>Refresh List
            </button>
            <div id="caseStudiesList" class="text-sm">
                <div class="text-gray-500">Click "Refresh List" to load current case studies</div>
            </div>
        </div>
    </div>

    <script>
        let testCaseStudyId = null;
        
        async function createTestCaseStudy() {
            const resultDiv = document.getElementById('createResult');
            resultDiv.innerHTML = '<div class="text-blue-600"><i class="fas fa-spinner fa-spin mr-2"></i>Creating test case study...</div>';
            
            const timestamp = Date.now();
            const testData = {
                project_title: `Homepage Integration Test ${timestamp}`,
                project_description: 'This case study was created to test the integration between the admin dashboard and the homepage "Magical Projects" section.',
                project_category: 'web-design',
                project_rating: 5,
                project_achievement: 'Successfully tested homepage integration',
                status: 'published',
                project_image_url: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=400&h=300&fit=crop',
                sections: {
                    hero: {
                        enabled: true,
                        title: `Homepage Integration Test ${timestamp}`,
                        subtitle: 'Testing Admin ‚Üî Homepage Connection',
                        description: 'This case study verifies that case studies created in the admin dashboard appear correctly on the homepage.'
                    },
                    overview: {
                        enabled: true,
                        title: 'Integration Overview',
                        summary: 'This test verifies the real-time connection between admin dashboard case study management and homepage display.'
                    }
                }
            };
            
            try {
                const response = await fetch('/api/case-studies', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    testCaseStudyId = result.id;
                    resultDiv.innerHTML = `
                        <div class="text-green-600">
                            <i class="fas fa-check-circle mr-2"></i>
                            <strong>Case Study Created!</strong><br>
                            <div class="mt-2 text-xs">
                                <strong>ID:</strong> ${result.id}<br>
                                <strong>Title:</strong> ${result.project_title}<br>
                                <strong>Status:</strong> ${result.status}<br>
                                <strong>Category:</strong> ${result.project_category}
                            </div>
                            <div class="mt-3">
                                <a href="/index.html#projects" target="_blank" 
                                   class="bg-green-500 text-white px-3 py-1 rounded text-xs mr-2">
                                    View on Homepage
                                </a>
                                <a href="/case_study.html?caseId=${result.id}" target="_blank" 
                                   class="bg-blue-500 text-white px-3 py-1 rounded text-xs">
                                    View Case Study
                                </a>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="text-red-600">
                            <i class="fas fa-times-circle mr-2"></i>
                            <strong>Creation Failed!</strong><br>
                            Error: ${result.error || 'Unknown error'}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="text-red-600">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        <strong>Network Error!</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        async function checkHomepageProjects() {
            const resultDiv = document.getElementById('homepageResult');
            resultDiv.innerHTML = '<div class="text-blue-600">Checking homepage data...</div>';
            
            try {
                const response = await fetch('/api/case-studies');
                const data = await response.json();
                
                if (response.ok) {
                    const publishedCount = data.filter(cs => cs.status === 'published').length;
                    resultDiv.innerHTML = `
                        <div class="text-green-600">
                            <i class="fas fa-check-circle mr-2"></i>
                            <strong>Homepage Data OK!</strong><br>
                            <div class="text-xs mt-1">
                                Total: ${data.length} case studies<br>
                                Published: ${publishedCount} (shown on homepage)<br>
                                Latest: ${data[0]?.project_title || 'None'}
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="text-red-600">‚ùå API Error: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-600">‚ùå Network Error: ${error.message}</div>`;
            }
        }
        
        async function checkAdminData() {
            const resultDiv = document.getElementById('adminResult');
            resultDiv.innerHTML = '<div class="text-blue-600">Checking admin data...</div>';
            
            try {
                const response = await fetch('/api/case-studies');
                const data = await response.json();
                
                if (response.ok) {
                    const draftCount = data.filter(cs => cs.status === 'draft').length;
                    const publishedCount = data.filter(cs => cs.status === 'published').length;
                    
                    resultDiv.innerHTML = `
                        <div class="text-green-600">
                            <i class="fas fa-check-circle mr-2"></i>
                            <strong>Admin Data OK!</strong><br>
                            <div class="text-xs mt-1">
                                Published: ${publishedCount}<br>
                                Drafts: ${draftCount}<br>
                                Total: ${data.length}
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="text-red-600">‚ùå API Error: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-600">‚ùå Network Error: ${error.message}</div>`;
            }
        }
        
        async function loadCurrentCaseStudies() {
            const listDiv = document.getElementById('caseStudiesList');
            listDiv.innerHTML = '<div class="text-blue-600"><i class="fas fa-spinner fa-spin mr-2"></i>Loading case studies...</div>';
            
            try {
                const response = await fetch('/api/case-studies');
                const data = await response.json();
                
                if (response.ok && data.length > 0) {
                    const caseStudiesHtml = data.map(cs => `
                        <div class="border-b border-gray-200 py-3 flex justify-between items-start">
                            <div class="flex-1">
                                <div class="font-semibold text-gray-900">${cs.project_title || 'Untitled'}</div>
                                <div class="text-xs text-gray-500 mt-1">
                                    ID: ${cs.id.substring(0, 8)}... | 
                                    Category: ${cs.project_category || 'N/A'} | 
                                    Status: <span class="px-2 py-1 rounded text-xs ${cs.status === 'published' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">${cs.status || 'draft'}</span>
                                </div>
                                <div class="text-xs text-gray-600 mt-1">${(cs.project_description || '').substring(0, 100)}${(cs.project_description || '').length > 100 ? '...' : ''}</div>
                            </div>
                            <div class="ml-4 flex space-x-2">
                                <a href="/case_study.html?caseId=${cs.id}" target="_blank" 
                                   class="text-blue-600 hover:text-blue-800 text-xs">View</a>
                                <a href="/admin-dashboard.html#case-studies" target="_blank" 
                                   class="text-purple-600 hover:text-purple-800 text-xs">Edit</a>
                            </div>
                        </div>
                    `).join('');
                    
                    listDiv.innerHTML = `
                        <div class="text-green-600 mb-4">
                            <i class="fas fa-check-circle mr-2"></i>Found ${data.length} case studies
                        </div>
                        <div class="max-h-96 overflow-y-auto">
                            ${caseStudiesHtml}
                        </div>
                    `;
                } else if (response.ok && data.length === 0) {
                    listDiv.innerHTML = '<div class="text-yellow-600">No case studies found. Create some using the admin dashboard!</div>';
                } else {
                    listDiv.innerHTML = `<div class="text-red-600">‚ùå Error loading case studies: ${data.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                listDiv.innerHTML = `<div class="text-red-600">‚ùå Network error: ${error.message}</div>`;
            }
        }
        
        // Auto-load case studies on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadCurrentCaseStudies();
        });
    </script>
</body>
</html>