<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Complete Case Studies Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h1 class="text-3xl font-bold mb-4">üîß Test Complete Case Studies Fix</h1>
            <p class="text-gray-600 mb-4">This page tests the complete case studies fix to ensure it works thoroughly.</p>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <button onclick="testStep1()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition">
                    1Ô∏è‚É£ Clear & Reset
                </button>
                <button onclick="testStep2()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">
                    2Ô∏è‚É£ Load Fix
                </button>
                <button onclick="testStep3()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 transition">
                    3Ô∏è‚É£ Test Display
                </button>
                <button onclick="testStep4()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 transition">
                    4Ô∏è‚É£ Open Dashboard
                </button>
            </div>
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <h3 class="font-semibold text-blue-800 mb-2">üìã Testing Process:</h3>
                <ol class="list-decimal list-inside text-blue-700 space-y-1 text-sm">
                    <li>Clear localStorage and reset everything</li>
                    <li>Load the complete case studies fix</li>
                    <li>Test the display functionality here</li>
                    <li>Open the actual admin dashboard to verify</li>
                </ol>
            </div>
        </div>

        <!-- Status Display -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üìä Current Status</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gray-50 p-4 rounded">
                    <h3 class="font-semibold mb-2">localStorage</h3>
                    <p id="localStorageStatus" class="text-sm text-gray-600">Checking...</p>
                </div>
                <div class="bg-gray-50 p-4 rounded">
                    <h3 class="font-semibold mb-2">Fix Status</h3>
                    <p id="fixStatus" class="text-sm text-gray-600">Not loaded</p>
                </div>
                <div class="bg-gray-50 p-4 rounded">
                    <h3 class="font-semibold mb-2">Case Studies</h3>
                    <p id="caseStudiesStatus" class="text-sm text-gray-600">0 found</p>
                </div>
            </div>
        </div>

        <!-- Test Case Studies Display -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">üìö Test Case Studies Display</h2>
                <div class="flex space-x-2">
                    <button onclick="refreshDisplay()" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                        üîÑ Refresh
                    </button>
                    <button onclick="clearData()" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
                        üóëÔ∏è Clear
                    </button>
                </div>
            </div>
            
            <div id="testCaseStudiesContainer" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                <div class="bg-gray-50 p-6 rounded-lg text-center">
                    <i class="fas fa-spinner fa-spin text-gray-400 text-2xl mb-2"></i>
                    <p class="text-gray-500">Waiting for test...</p>
                </div>
            </div>
        </div>

        <!-- Debug Log -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">üìù Debug Log</h2>
            <div id="debugLog" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm h-64 overflow-y-auto">
                <div>Test environment ready...</div>
            </div>
        </div>
    </div>

    <!-- Load the complete fix -->
    <script src="complete-case-studies-fix.js"></script>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-blue-400',
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400'
            };
            
            const entry = document.createElement('div');
            entry.className = colors[type] || 'text-green-400';
            entry.textContent = `[${timestamp}] ${message}`;
            
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus() {
            // Check localStorage
            const storedData = localStorage.getItem('portfolio_case_studies');
            const caseStudies = storedData ? JSON.parse(storedData) : [];
            
            document.getElementById('localStorageStatus').textContent = 
                storedData ? `‚úÖ ${caseStudies.length} case studies` : '‚ùå Empty';
            
            document.getElementById('caseStudiesStatus').textContent = 
                `${caseStudies.length} case studies found`;
            
            // Check if fix is loaded
            const fixLoaded = typeof window.createSampleCaseStudies === 'function';
            document.getElementById('fixStatus').textContent = 
                fixLoaded ? '‚úÖ Fix loaded' : '‚ùå Fix not loaded';
            
            return caseStudies;
        }

        function testStep1() {
            log('1Ô∏è‚É£ Step 1: Clear & Reset', 'info');
            
            try {
                // Clear localStorage
                localStorage.removeItem('portfolio_case_studies');
                log('üóëÔ∏è localStorage cleared', 'success');
                
                // Clear test display
                document.getElementById('testCaseStudiesContainer').innerHTML = `
                    <div class="bg-gray-50 p-6 rounded-lg text-center col-span-full">
                        <i class="fas fa-broom text-gray-400 text-2xl mb-2"></i>
                        <p class="text-gray-500">Cleared - Ready for testing</p>
                    </div>
                `;
                
                updateStatus();
                log('‚úÖ Step 1 complete - Everything cleared', 'success');
                
            } catch (error) {
                log(`‚ùå Error in step 1: ${error.message}`, 'error');
            }
        }

        function testStep2() {
            log('2Ô∏è‚É£ Step 2: Load Fix', 'info');
            
            try {
                // Check if fix is loaded
                if (typeof window.createSampleCaseStudies === 'function') {
                    log('‚úÖ Complete case studies fix is loaded', 'success');
                    
                    // Create sample data
                    window.createSampleCaseStudies();
                    log('üìù Sample case studies created', 'success');
                    
                    updateStatus();
                    log('‚úÖ Step 2 complete - Fix loaded and data created', 'success');
                    
                } else {
                    log('‚ùå Complete case studies fix not loaded', 'error');
                    log('üí° The fix script may not have loaded properly', 'warning');
                }
                
            } catch (error) {
                log(`‚ùå Error in step 2: ${error.message}`, 'error');
            }
        }

        function testStep3() {
            log('3Ô∏è‚É£ Step 3: Test Display', 'info');
            
            try {
                const caseStudies = updateStatus();
                
                if (caseStudies.length === 0) {
                    log('‚ö†Ô∏è No case studies found, creating sample data first...', 'warning');
                    if (typeof window.createSampleCaseStudies === 'function') {
                        window.createSampleCaseStudies();
                        // Reload after creating data
                        setTimeout(() => testStep3(), 500);
                        return;
                    }
                }
                
                // Display case studies in test container
                displayTestCaseStudies(caseStudies);
                
                log('‚úÖ Step 3 complete - Display tested', 'success');
                
            } catch (error) {
                log(`‚ùå Error in step 3: ${error.message}`, 'error');
            }
        }

        function testStep4() {
            log('4Ô∏è‚É£ Step 4: Open Dashboard', 'info');
            
            try {
                // Open admin dashboard
                const dashboardWindow = window.open('admin-dashboard.html', '_blank');
                
                if (dashboardWindow) {
                    log('‚úÖ Admin dashboard opened in new tab', 'success');
                    log('üîç Navigate to "Case Studies" to verify the fix works', 'info');
                    log('üí° You should see case studies displayed (not blank)', 'warning');
                } else {
                    log('‚ùå Failed to open dashboard (popup blocked?)', 'error');
                    log('üí° Try manually opening admin-dashboard.html', 'warning');
                }
                
                log('‚úÖ Step 4 complete - Dashboard opened for verification', 'success');
                
            } catch (error) {
                log(`‚ùå Error in step 4: ${error.message}`, 'error');
            }
        }

        function displayTestCaseStudies(caseStudies) {
            const container = document.getElementById('testCaseStudiesContainer');
            
            if (caseStudies.length === 0) {
                container.innerHTML = `
                    <div class="bg-yellow-50 border border-yellow-200 p-6 rounded-lg text-center col-span-full">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-2xl mb-2"></i>
                        <p class="text-yellow-700">No case studies found</p>
                        <button onclick="testStep2()" class="mt-2 bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600">
                            Create Sample Data
                        </button>
                    </div>
                `;
                return;
            }

            const cards = caseStudies.map(cs => `
                <div class="bg-white border rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div class="flex items-start justify-between mb-3">
                        <h3 class="font-semibold text-gray-900 text-sm">${cs.project_title || 'Untitled'}</h3>
                        <div class="flex items-center space-x-1">
                            <span class="px-2 py-1 text-xs rounded ${
                                cs.status === 'published' ? 'bg-green-100 text-green-800' :
                                cs.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                'bg-gray-100 text-gray-800'
                            }">
                                ${cs.status}
                            </span>
                            ${cs.featured ? '<i class="fas fa-star text-yellow-500 text-xs"></i>' : ''}
                        </div>
                    </div>
                    <p class="text-gray-600 text-xs mb-3 line-clamp-2">
                        ${(cs.project_description || cs.heroSubtitle || 'No description').substring(0, 100)}...
                    </p>
                    <div class="flex justify-between items-center text-xs text-gray-500">
                        <span>${new Date(cs.created_at).toLocaleDateString()}</span>
                        <span>ID: ${cs.id.substring(0, 8)}...</span>
                    </div>
                </div>
            `).join('');

            container.innerHTML = cards;
            log(`üé® Displayed ${caseStudies.length} case studies in test container`, 'success');
        }

        function refreshDisplay() {
            log('üîÑ Refreshing display...', 'info');
            updateStatus();
            testStep3();
        }

        function clearData() {
            log('üóëÔ∏è Clearing data...', 'warning');
            testStep1();
        }

        // Initialize
        window.addEventListener('load', () => {
            log('üöÄ Test environment loaded', 'success');
            log('üìã Follow the numbered steps to test the complete fix', 'info');
            
            setTimeout(() => {
                updateStatus();
                log('üìä Initial status check complete', 'info');
            }, 1000);
        });

        // Auto-update status every 5 seconds
        setInterval(updateStatus, 5000);
    </script>
</body>
</html>