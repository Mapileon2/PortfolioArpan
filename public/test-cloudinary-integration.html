<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudinary Integration Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Cloudinary SDK -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="max-w-4xl mx-auto px-4">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">
                <i class="fas fa-cloud-upload-alt text-blue-600 mr-3"></i>
                Cloudinary Integration Test
            </h1>

            <!-- Configuration Status -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-800 mb-2">
                        <i class="fas fa-cloud mr-2"></i>Cloud Name
                    </h3>
                    <div id="cloudNameStatus" class="text-sm">
                        <span class="font-mono bg-blue-100 px-2 py-1 rounded">dgymjtqil</span>
                    </div>
                </div>

                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <h3 class="font-semibold text-green-800 mb-2">
                        <i class="fas fa-key mr-2"></i>API Key
                    </h3>
                    <div id="apiKeyStatus" class="text-sm">
                        <span class="font-mono bg-green-100 px-2 py-1 rounded">951533987774134</span>
                    </div>
                </div>

                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <h3 class="font-semibold text-purple-800 mb-2">
                        <i class="fas fa-cog mr-2"></i>SDK Status
                    </h3>
                    <div id="sdkStatus" class="text-sm">
                        <i class="fas fa-spinner fa-spin text-purple-600"></i> Checking...
                    </div>
                </div>
            </div>

            <!-- Test Results -->
            <div class="bg-gray-50 rounded-lg p-6 mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Integration Test Results</h2>
                <div id="testResults" class="space-y-2 text-sm font-mono">
                    <div class="text-gray-600">Starting Cloudinary integration tests...</div>
                </div>
            </div>

            <!-- Upload Test -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white border border-gray-200 rounded-lg p-6">
                    <h3 class="font-semibold text-gray-800 mb-4">Upload Widget Test</h3>
                    <div class="space-y-4">
                        <button id="testUploadWidget" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-upload mr-2"></i>Test Upload Widget
                        </button>
                        <div id="uploadResult" class="hidden">
                            <img id="uploadedImage" class="w-full h-48 object-cover rounded-lg mb-2">
                            <p class="text-sm text-gray-600">Upload successful!</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white border border-gray-200 rounded-lg p-6">
                    <h3 class="font-semibold text-gray-800 mb-4">Direct Upload Test</h3>
                    <div class="space-y-4">
                        <input type="file" id="fileInput" accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <button id="testDirectUpload" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-cloud-upload-alt mr-2"></i>Test Direct Upload
                        </button>
                        <div id="directUploadResult" class="hidden">
                            <img id="directUploadedImage" class="w-full h-48 object-cover rounded-lg mb-2">
                            <p class="text-sm text-gray-600">Direct upload successful!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Image URL Generation Test -->
            <div class="mt-6 bg-white border border-gray-200 rounded-lg p-6">
                <h3 class="font-semibold text-gray-800 mb-4">Image URL Generation Test</h3>
                <div class="space-y-4">
                    <input type="text" id="publicIdInput" placeholder="Enter public ID (e.g., sample)" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    <button id="testUrlGeneration" class="bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors">
                        <i class="fas fa-link mr-2"></i>Generate URLs
                    </button>
                    <div id="urlResults" class="hidden space-y-2">
                        <!-- URL results will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Cloudinary Configuration with your actual credentials
        const CLOUDINARY_CONFIG = {
            cloudName: 'dgymjtqil',
            apiKey: '951533987774134',
            uploadPreset: 'ml_default'
        };

        class CloudinaryTester {
            constructor() {
                this.init();
            }

            async init() {
                console.log('ðŸ§ª Initializing Cloudinary Integration Test...');
                
                // Check SDK availability
                await this.checkSDKStatus();
                
                // Run configuration tests
                this.runConfigurationTests();
                
                // Setup event listeners
                this.setupEventListeners();
                
                console.log('âœ… Cloudinary Integration Test ready');
            }

            async checkSDKStatus() {
                const statusElement = document.getElementById('sdkStatus');
                
                if (typeof cloudinary !== 'undefined') {
                    statusElement.innerHTML = '<i class="fas fa-check-circle text-green-600"></i> SDK Loaded';
                    this.log('âœ… Cloudinary SDK loaded successfully');
                } else {
                    statusElement.innerHTML = '<i class="fas fa-times-circle text-red-600"></i> SDK Not Found';
                    this.log('âŒ Cloudinary SDK not found');
                }
            }

            runConfigurationTests() {
                this.log('ðŸ” Testing Cloudinary configuration...');
                
                // Test cloud name
                if (CLOUDINARY_CONFIG.cloudName && CLOUDINARY_CONFIG.cloudName !== 'your-cloud-name') {
                    this.log(`âœ… Cloud Name: ${CLOUDINARY_CONFIG.cloudName}`);
                } else {
                    this.log('âŒ Cloud Name not configured');
                }
                
                // Test API key
                if (CLOUDINARY_CONFIG.apiKey && CLOUDINARY_CONFIG.apiKey !== 'your-api-key') {
                    this.log(`âœ… API Key: ${CLOUDINARY_CONFIG.apiKey}`);
                } else {
                    this.log('âŒ API Key not configured');
                }
                
                // Test upload preset
                this.log(`â„¹ï¸ Upload Preset: ${CLOUDINARY_CONFIG.uploadPreset}`);
                
                // Test image URL generation
                const testUrl = this.generateImageUrl('sample', { width: 300, height: 200, crop: 'fill' });
                this.log(`âœ… Sample URL: ${testUrl}`);
            }

            setupEventListeners() {
                // Upload widget test
                document.getElementById('testUploadWidget').addEventListener('click', () => {
                    this.testUploadWidget();
                });

                // Direct upload test
                document.getElementById('testDirectUpload').addEventListener('click', () => {
                    this.testDirectUpload();
                });

                // URL generation test
                document.getElementById('testUrlGeneration').addEventListener('click', () => {
                    this.testUrlGeneration();
                });
            }

            testUploadWidget() {
                this.log('ðŸ§ª Testing upload widget...');
                
                if (typeof cloudinary === 'undefined') {
                    this.log('âŒ Cloudinary SDK not available');
                    return;
                }

                try {
                    const widget = cloudinary.createUploadWidget({
                        cloudName: CLOUDINARY_CONFIG.cloudName,
                        uploadPreset: CLOUDINARY_CONFIG.uploadPreset,
                        sources: ['local'],
                        multiple: false,
                        maxFiles: 1,
                        folder: 'test-uploads',
                        tags: ['test']
                    }, (error, result) => {
                        if (!error && result && result.event === "success") {
                            this.log('âœ… Upload widget test successful');
                            this.displayUploadResult(result.info.secure_url, 'uploadResult', 'uploadedImage');
                        } else if (error) {
                            this.log(`âŒ Upload widget error: ${error.message || error}`);
                        }
                    });

                    widget.open();
                    this.log('â„¹ï¸ Upload widget opened');
                } catch (error) {
                    this.log(`âŒ Upload widget test failed: ${error.message}`);
                }
            }

            async testDirectUpload() {
                const fileInput = document.getElementById('fileInput');
                const file = fileInput.files[0];

                if (!file) {
                    this.log('âŒ Please select a file first');
                    return;
                }

                this.log('ðŸ§ª Testing direct upload...');

                try {
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('upload_preset', CLOUDINARY_CONFIG.uploadPreset);
                    formData.append('folder', 'test-uploads');
                    formData.append('tags', 'test,direct-upload');

                    const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CONFIG.cloudName}/image/upload`, {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const result = await response.json();
                    this.log('âœ… Direct upload test successful');
                    this.displayUploadResult(result.secure_url, 'directUploadResult', 'directUploadedImage');

                } catch (error) {
                    this.log(`âŒ Direct upload test failed: ${error.message}`);
                }
            }

            testUrlGeneration() {
                const publicId = document.getElementById('publicIdInput').value || 'sample';
                this.log(`ðŸ§ª Testing URL generation for: ${publicId}`);

                const urls = {
                    'Original': this.generateImageUrl(publicId),
                    'Thumbnail (300x200)': this.generateImageUrl(publicId, { width: 300, height: 200, crop: 'fill' }),
                    'Hero (1200x600)': this.generateImageUrl(publicId, { width: 1200, height: 600, crop: 'fill' }),
                    'Auto Quality': this.generateImageUrl(publicId, { quality: 'auto', format: 'auto' }),
                    'Circular (150x150)': this.generateImageUrl(publicId, { width: 150, height: 150, crop: 'fill', radius: 'max' })
                };

                const resultsContainer = document.getElementById('urlResults');
                resultsContainer.innerHTML = '';
                resultsContainer.classList.remove('hidden');

                Object.entries(urls).forEach(([name, url]) => {
                    const div = document.createElement('div');
                    div.className = 'bg-gray-50 p-3 rounded';
                    div.innerHTML = `
                        <div class="font-semibold text-gray-700">${name}</div>
                        <div class="text-sm text-gray-600 break-all">${url}</div>
                        <img src="${url}" class="mt-2 h-20 object-cover rounded" onerror="this.style.display='none'">
                    `;
                    resultsContainer.appendChild(div);
                });

                this.log('âœ… URL generation test completed');
            }

            generateImageUrl(publicId, transformations = {}) {
                const baseUrl = `https://res.cloudinary.com/${CLOUDINARY_CONFIG.cloudName}/image/upload/`;
                
                const parts = [];
                if (transformations.width) parts.push(`w_${transformations.width}`);
                if (transformations.height) parts.push(`h_${transformations.height}`);
                if (transformations.crop) parts.push(`c_${transformations.crop}`);
                if (transformations.quality) parts.push(`q_${transformations.quality}`);
                if (transformations.format) parts.push(`f_${transformations.format}`);
                if (transformations.radius) parts.push(`r_${transformations.radius}`);
                
                const transformString = parts.length > 0 ? parts.join(',') + '/' : '';
                return `${baseUrl}${transformString}${publicId}`;
            }

            displayUploadResult(imageUrl, containerId, imageId) {
                const container = document.getElementById(containerId);
                const image = document.getElementById(imageId);
                
                image.src = imageUrl;
                container.classList.remove('hidden');
            }

            log(message) {
                console.log(message);
                const resultsDiv = document.getElementById('testResults');
                const logEntry = document.createElement('div');
                logEntry.className = 'text-gray-800';
                logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                resultsDiv.appendChild(logEntry);
                resultsDiv.scrollTop = resultsDiv.scrollHeight;
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new CloudinaryTester();
        });
    </script>
</body>
</html>